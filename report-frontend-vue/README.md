# Report Constructor (Vue + Vite)

Новый фронт «report-frontend-vue» на базе стилей NSI.

## Старт

```bash
npm install
npm run dev
```

Откройте `http://localhost:5173`.

## Использование в интерфейсе

### Мастер представлений (раздел «Данные»)

Раздел «Данные» открывается из «Представления» → «Создать представление» или из карточки представления («Открыть»).

1. **Источник**  
   Выберите существующий источник или создайте новый, задайте URL/метод/RPC-метод и параметры запроса.  
   Нажмите «Отправить данные» — мастер загрузит таблицу и откроет следующие шаги.  
   При необходимости добавьте связи (joins) с другими источниками.
   - В блоке **Pushdown (оптимизация upstream)** можно добавить mapping (paging/filters) для upstream.  
     Это только метаданные: реально применится только если backend разрешит pushdown для этого источника.
2. **Макет** (только для источников со сводной таблицей)  
   Выберите или создайте конфигурацию, настройте фильтры, строки, столбцы и метрики.  
   Проверьте предпросмотр и сохраните конфигурацию; при необходимости откройте «Словарь полей».
3. **Вид**  
   Выберите или создайте представление, укажите название/описание и тип визуализации.  
   Сохраните представление — оно появится в разделе «Представления» и будет доступно для страниц.

### Представления

- Раздел содержит список сохранённых представлений и их конфигураций.
- Из карточки можно открыть, отредактировать метаданные (название/описание/визуализация) или удалить представление.
- Кнопка «Создать представление» ведёт в мастер «Данные».

### Страницы

1. Откройте «Страницы» и нажмите «Создать страницу».
2. Заполните пункт меню, заголовок и описание. Выберите публичность и, при необходимости, пользователей.
3. Задайте макет: пресет, количество вкладок и их названия.
4. Добавьте контейнеры, привяжите к каждому представление и настройте ширину/высоту/вкладку.
5. Выберите глобальные фильтры (доступны только поля, общие для всех контейнеров).
6. Сохраните страницу — она появится в списке и в сайдбаре «Дашборды».

## Прокси/CORS

- Цель бэка задаётся в `.env.development` (`VITE_PROXY_TARGET`).
- Все запросы на `/api/**` проксируются Vite на указанный бэкэнд.
- Базовый URL клиента: `VITE_API_BASE` (по умолчанию `/api`).

## Диагностика запросов (API probe)

Установите `VITE_REPORT_API_PROBE=1`, чтобы включить диагностику запросов к upstream.
Логируется только служебная информация (URL, метод и ключи payload), без значений.
По умолчанию логирование выключено; после изменения переменной перезапустите dev-сервер.

## Структура

- `src/app` — оболочка приложения и провайдеры.
- `src/layouts` — каркасы страниц.
- `src/pages` — роутовые страницы (Данные/Представления/О проекте).
- `src/shared` — общие стили, api-клиент, конфиги, утилиты.
- `src/shared/styles` — токены/база, скопированные из NSI.
- `src/shared/assets` — логотип бренда.

## Добавление источников отчётов

- Расширяйте форму на главной странице (`src/pages/HomePage.vue`) и/или добавляйте новые сущности в `src/features`/`src/entities`.
- Отправляйте запросы через `api` из `src/shared/api/http.js` на нужные эндпоинты `/api/...` (будут проксированы на бэк).

## Линт

```bash
npm run lint
```

Используются ESLint + Prettier (Vue 3).
